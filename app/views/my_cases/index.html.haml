- content_for :title, I18n.t('my_cases.index.my_cases')


.admin.md-container
  %header.md-header.bp4-dark
    %h1.admin__title
      = t '.my_cases'

  %aside.md-master
    .bp4-dark
      %h2.admin__title
        = t '.create_a_case'
        = link_to 'https://docs.learngala.com/docs/',
                  class: %i[bp4-button bp4-minimal bp4-icon-help],
                  aria: { label: I18n.t('helpers.help') },
                  target: '_blank', rel: 'noopener noreferrer' do
          -# Empty

      :markdown
        #{t '.put_your_own_cases_on_gala'}

    - if reader_signed_in?
      .bp4-dark
        = form_with model: Case.new, local: true do |f|
          = f.submit I18n.t('my_cases.index.new_case'),
                     class: 'bp4-button bp4-intent-success bp4-icon-add'
          .bp4-select
            = f.select :locale, options_for_select(locale_names,
                                                   current_user.locale)
    - else
      .bp4-card.bp4-elevation-4.devise-card
        = render 'devise/sessions/sign_in', resource: Reader.new


  %main.md-detail.bp4-dark
    - if @cases.any?
      %table.admin__table.bp4-html-table.my-cases__table
        %thead
          %td
          %td= t 'activerecord.attributes.case.case_title'
          - if current_reader.has_role? :editor
            %td First Editor
          - else
            %td= t 'activerecord.attributes.case.slug'
          %td= t 'activerecord.attributes.case.locale'
          %td= t 'activerecord.attributes.case.library'
          %td= t 'activerecord.attributes.case.published'
          %td
          %td
          %td

        %tbody
          -@cases.each do |kase|
            %tr
              %td
                %img.admin__table__thumbnail{ src: kase.small_cover_url,
                                              role: 'presentation' }

              %td
                = link_to case_path kase do
                  %span.admin__table__slug
                    = kase.short_title
                    - if kase.featured?
                      %span.bp4-tag.bp4-minimal.bp4-intent-success
                        = succeed ':' do
                          = t '.featured'
                        = localize kase.featured_at.to_date
                  = kase.title

              - if current_reader.has_role? :editor
                %td= kase.editorships.first&.editor_name
              - else
                %td
                  = link_to case_path kase do
                    %code= kase.slug

              %td= Translation.language_name kase.locale

              %td= kase.library.name

              %td{title: kase.published_at}
                - if kase.published?
                  = localize kase.published_at.to_date, format: :long
                - else
                  â€”

              %td
                = link_to '', edit_case_path(kase),
                          aria: { label: t('.edit_case') },
                          class: 'bp4-button bp4-minimal bp4-icon-edit'

              %td
                = link_to '', edit_case_settings_path(kase),
                          aria: { label: t('.edit_case_settings') },
                          class: 'bp4-button bp4-minimal bp4-icon-cog'

              %td
                = link_to '', case_confirm_deletion_path(kase),
                          class: 'bp4-button bp4-minimal bp4-intent-danger bp4-icon-trash',
                          aria: { label: t('.delete_case') }

    - else
      .bp4-non-ideal-state
        .bp4-non-ideal-state-visual.bp4-non-ideal-state-icon
          %span.bp4-icon.bp4-icon-folder-open
        %h4.bp4-non-ideal-state-title
          = t '.youre_not_authoring_any_cases'
        .bp4-non-ideal-state-description
          = t '.once_youve_created'
