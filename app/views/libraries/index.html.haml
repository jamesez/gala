- content_for :title, I18n.t('libraries.index.libraries')

.admin.md-container
  %header.md-header.bp4-dark
    %h1.admin__title
      = t '.libraries'

  %aside.md-master.spaced
    - if policy(Library).create?
      .bp4-card
        %h2.admin__title= t '.create_a_new_library'
        = render 'form'

    .bp4-dark
      .bp4-callout.bp4-icon-git-push
        = t '.libraries_on_gala'

  %main.md-detail.bp4-dark
    %table.admin__table.bp4-html-table.libraries__table
      %thead
        %th(scope="col")=# Logo
        %th(scope="col")= t 'activerecord.attributes.library.name'
        %th(scope="col")=# Url
        %th(scope="col")= t 'activerecord.attributes.library.description'
        %th(scope="col")=# Number of Cases
        %th(scope="col")=# Edit link
        %th(scope="col")=# Delete link

      %tbody
        - libraries.each do |library|
          %tr
            %td.library-logo{ style: library.define_color_variables }
              %img{ src: library.logo_url, alt: '' }

            %td
              = library.name
              - if policy(Library).create? && library.visible_in_catalog?
                %span.bp4-tag.bp4-minimal.bp4-intent-success
                  = t '.on_home_page'

            %td
              - unless library.url.blank?
                = link_to library.url,
                          class: %i[bp4-button bp4-minimal bp4-icon-share],
                          aria: { label: I18n.t('activerecord.attributes.library.website') },
                          target: 'blank' do
                  -# Empty

            %td.library-description
              = truncate library.description, length: 140, separator: ' ' do
                &emsp;
                = link_to t('helpers.less.read_more'), library.catalog_path

            %td
              = link_to pluralize(library.cases_count, 'case'),
                        library.catalog_path,
                        class: %i[bp4-button bp4-icon-book library-button]

            %td
              - if policy(library).update?
                = link_to edit_library_path(library),
                          class: %i[bp4-button bp4-minimal bp4-icon-cog],
                          aria: { label: I18n.t('helpers.edit') } do
                  -# Empty
            %td
              - if policy(library).destroy?
                = button_to library_path(library), method: :delete,
                          data: { confirm: I18n.t('libraries.destroy.are_you_sure') },
                          class: %i[bp4-button bp4-minimal bp4-intent-danger bp4-icon-trash],
                          aria: { label: I18n.t('libraries.destroy.delete_library') } do
                  -# Empty
